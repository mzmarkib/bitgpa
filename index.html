<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    
    <header class="header">
        <div>Grade Point Average Calculator</div>
        <div>BIT-UCSC</div>
    </header>
    <footer></footer>
    <main>
        <section id="home" class="page home">
            <form id="gpaForm">
                
            </form>
        </section>
        <section class="page faq">
            <div class="container">
                <div class="title">FAQ</div>
                <div class="desc">Deals with a few questions that are frequently arise in students and are not sometimes answered.If you have any further questions you can ask them via the details in the contact page. We hope they are helpful...</div>
                <div class="faq-touple">
                    <div class="question">How many times can I repeat a subject?</div>
                    <div class="answer">You can have upto Three(3) attempts on a particular subject.</div>
                </div>
                <div class="faq-touple">
                    <div class="question">What is the highest grade that can I get when I attempt a particular subject for the second time?</div>
                    <div class="answer">You can obatain any grade upto an A, <strong>but</strong> when accounting the Grade Point Value (GPV) for that particular subject can be upto 2.00 (GPV of a C grade).</div>
                </div>
                <div class="faq-touple">
                    <div class="question">What is the Difference between an A grade and an A+ grade</div>
                    <div class="answer">Both A and A+ grades carries the same Grade Point Value (GPV) values of 4.00, <strong>but</strong> When calculating GPA for class awarding, and A+ will be given a Grade Point Value (GPV) of 4.25.</div>
                </div>
                <div class="faq-touple">
                    <div class="question">If I applied for a particular Exam and did not attend the exam, will it still count as an Attempt?</div>
                    <div class="answer">No, If you are absent for an absent for an exam it will be counted as NOT SAT. On the other hand you are expected to produce a Medical for your absence.</div>
                </div>
                <div class="faq-touple">
                    <div class="question">What is a Credit?</div>
                    <div class="answer">It is the measure of how much content a particular subject carries. A credit is equal to 15 hours of lectures or 30-45 hours of practical or an equivalent combination of lectures.</div>
                </div>                
            </div>
        </section>
        <section class="page about">
            <div class="container">
                <div class="title">About</div>
            </div>
        </section>
        <section class="page contact">
            <div class="container">
                <div class="title">Contact</div>
            </div>
        </section>
    </main>    
    
    
    
    <!-- Grades Dialog Box HTML start -->
    <div class="dialogOverlay">        
    </div>
    <div class="gradesPrompt">
        <div class="innerBox">
            <div class="promptHeader">
            Select your Grade: <span class="promptClose">X</span>
            </div>
            <div class="promptBody">
                <div class="grades">
                <div data_gpv="4" class="green grade">A+</div>
                <div data_gpv="4" class="green grade">A</div>
                <div data_gpv="3.75" class="green grade">A-</div>
                <div data_gpv="3.25" class="orange grade">B+</div>
                <div data_gpv="3" class="orange grade">B</div>
                <div data_gpv="2.75" class="orange grade">B-</div>
                <div data_gpv="2.25" class="orangered grade">C+</div>
                <div data_gpv="2" class="orangered grade">C</div>
                <div data_gpv="1.75" class="orangered grade">C-</div>
                <div data_gpv="1.25" class="red grade">D+</div>
                <div data_gpv="1" class="red grade">D</div>
                <div data_gpv="0.75" class="red grade">D-</div>
                <div data_gpv="0" class="darkred grade">E</div>
                <div data_gpv="-1" class="grade">NOT SAT</div>
                </div>
            </div>
        </div>
    </div>         
    <!-- Grades Dialog Box HTML end -->


    <nav class="navbar">
        <div class="container">
            <div name="home" class="item active">
                <div name="home"><img src="img/icons/home1.png"></div>
                <div>Home</div>
            </div>
            <div name="faq" class="item">
                <div name="home"><img src="img/icons/faq2.png"></div>
                <div>FAQ</div>
            </div> 
            <div name="calc" class="item cta_calc">
                <div><img src="img/icons/dash1.png"></div>
            </div> 
            <div name="about" class="item">
                <div name="home"><img src="img/icons/info3.png"></div>
                <div>About</div>
            </div> 
            <div name="contact" class="item">
                <div name="home"><img src="img/icons/info2.png"></div>
                <div>Contact</div>
            </div>
        </div>                       
    </nav>
    <div class="gpaBox">
        <div class="container">
            <div class="gpaClose">x</div>
            <div class="gpaResult">
                <p>3.75</p>
            </div>
            <div class="gpaDetails">
                <p>Total Credits : <span id="totCredits">15</span></p>
                <p>Subjects Calculated  : <span id="totSubjects">15</span></p>
                <p>Expected Class: <span id="classExp">1st Class</span></p>
            </div>
        </div>
    </div>
    

    <script>     
        //declarations
        const gpaResultBox = new gpaBox();

        openPage(".faq");
        function openPage(page){
            let pages = document.querySelectorAll(".page");
            for (let i = 0; i < pages.length; ++i) {
                pages[i].style.display= "none";
            }

            page = document.querySelector(page);
            page.style.display = "block";

        }

        // Navigation click events (to be completed)
        let navLinks = document.querySelectorAll(".navbar .item");        
        navLinks.forEach(function(link){            
            link.addEventListener("click",function(e){
                let attr = e.currentTarget.getAttribute('name');                
                if(attr !== "calc"){
                    openPage("." + attr);
                    navLinks.forEach(function(item){
                        item.classList.remove("active");
                    });
                    e.currentTarget.classList.add("active");
                }else{
                    if(!gpaResultBox.status){
                        gpaResultBox.open();
                    }else{
                        gpaResultBox.close();
                    }
                }
            });
        });
        

        //Custom Grades Prompt
        let clickedSub; //the sebject that was clicked to changed
        function GradesPrompt(){

            this.render = function(e){
                // Displays the Grades Prompt
                document.querySelector(".gradesPrompt").style.display = "flex";
                document.querySelector(".dialogOverlay").style.display = "block";
                clickedSub = e;
            }

            this.close = function(){
                document.querySelector(".gradesPrompt").style.display = "none";
                document.querySelector(".dialogOverlay").style.display = "none";
            }
            
        }
        
        //Closes Grades Prompt when the Close button or the Overlay is clicked on
        var Prompt = new GradesPrompt();

        const closeBtns = document.querySelectorAll(".dialogOverlay, .promptClose");

        closeBtns.forEach(function(closeBtn){
            closeBtn.addEventListener("click",function(e){
                Prompt.close();
            });
        });        

        // Changes the Values of the SELECT button when a result is chosen
        const gradeBtns = document.querySelectorAll(".grades .grade");
        gradeBtns.forEach(function(gradeBtn){
            gradeBtn.addEventListener("click",function(e){
                let grade = e.target.innerHTML;
                let gpv = e.target.getAttribute("data_gpv");
                clickedSub.target.innerHTML = grade;
                clickedSub.target.setAttribute("data_gpv",gpv);
                Prompt.close();
            });
        });


        //Once the Body Loads
        const body = document.querySelector("body");

        body.onload = function(){
            //loads the list of subjects
            getSubjects().then((data) => {
                let subjectSrting = ""; //initialize variable that holds the html of all the subjects semester wise

                // loops around each semester                
                data.forEach(function(semester){                    
                    
                    subjectSrting += "<div class='semester'> <div class='title yearTitle'>"+ semester.year +"</div> <div class='title semesterTitle'>"+ semester.semester +"</div>";

                    // loops around each subject for each semester
                    semester.subjects.forEach(function (subject){
                        let dis = ""
                        if(subject.type != "C"){
                            dis = "disabledSub";
                        }
                        subjectSrting += "<div class='subject "+dis+"'> <div class='sub'><span class='code'>" + subject.code + "</span><span class='name'>" + subject.name + "</span></div> <div class='subCredits'>" + subject.cred + "</div> <div class='attempt'> <input type='checkbox' id='" + subject.code + "' checked><label for='" + subject.code + "'>1st</label> </div> <button type='button' data_gpv='-1'  class='subResult'>SELECT</button> </div>";
                    });                    
                    
                    subjectSrting += "</div>";
                    
                });                
                
                let form = document.querySelector(".home form");
                form.innerHTML = subjectSrting;

                //Opens Grades Prompt for each SELECT Button when Clicked
                const resultBtns = document.querySelectorAll(".subResult");

                resultBtns.forEach(function(resultBtn){
                    resultBtn.addEventListener("click",function(e){
                        Prompt.render(e);
                    });
                });
                
            })
        }
        
        //Object and controls for GPA result Box
        function gpaBox () {
            this.object = document.querySelector(".gpaBox");
            this.status = false;            

            

            this.open = function(){ 
                this.object.style.display = "block";
                this.status =  true;
            },
            this.close = function(){
                this.object.style.display = "none";
                this.status = false;
            }
        }
        //Event listener for click on the gpaResultBox close Btn
        const gpaClose = document.querySelectorAll(".gpaClose");
        gpaClose.forEach(function(closeBtn){
            closeBtn.addEventListener("click",function(e){
                gpaResultBox.close();
            });
        });     

        function calculateGpa(){
            let subjects = document.getElementsByClassName("home")[0].getElementsByClassName('subject');
            // subjects = subjects.querySelectorAll('.subject');
            // console.log(subjects.length);
            
            console.log(document.getElementById("gpaForm").length);                                
        }

        calculateGpa();

        //Function that retrieves data from the the subjects.json file
        let page = document.querySelector(".home form");
        const getSubjects = async function() {
            return await fetch("data/subjects.json")
            .then(res => { return res.json() })
            .then(data => { 
                return data;
            })
            .catch(error => console.log(error))
        }

    </script>
</body>
</html>